<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Homecrew - Eerste keer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="login-box">
    <h1>Welkom bij Homecrew</h1>
    <p>Vul je naam in en kies een wachtwoord/pincode</p>

    <input type="text" id="username" placeholder="Naam">
    <input type="password" id="password" placeholder="Wachtwoord/pincode">

    <label style="display:flex; align-items:center; gap:10px; margin-top:10px;">
        <input type="checkbox" id="stayLoggedIn">
        Blijf ingelogd
    </label>

    <button id="startBtn">Start</button>
    <p id="error" style="color:red; margin-top:10px;"></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, setPersistence, browserLocalPersistence, inMemoryPersistence } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

// Firebase config
const firebaseConfig = {
    apiKey: "AIzaSyCwlr069pxNXEEhIEGNug5Ly_kKSuvxSzs",
    authDomain: "homecrew-d8e21.firebaseapp.com",
    projectId: "homecrew-d8e21",
    storageBucket: "homecrew-d8e21.firebasestorage.app",
    messagingSenderId: "47664248188",
    appId: "1:47664248188:web:0994c6b2ba07f6fee060f9"
};

// Init Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// Als al ingelogd → dashboard
if(localStorage.getItem("homecrewUser")) window.location.href = "dashboard.html";

// Start knop
document.getElementById("startBtn").addEventListener("click", async () => {
    const username = document.getElementById("username").value.trim().toLowerCase();
    const password = document.getElementById("password").value.trim();
    const stayLoggedIn = document.getElementById("stayLoggedIn").checked;
    const errorEl = document.getElementById("error");

    if(!username || !password){
        errorEl.textContent = "Vul naam en wachtwoord in";
        return;
    }

    try {
        // Kies persistentie
        await setPersistence(auth, stayLoggedIn ? browserLocalPersistence : inMemoryPersistence);

        // Probeer login
        await signInWithEmailAndPassword(auth, username+"@homecrew.local", password);
        localStorage.setItem("homecrewUser", username);
        window.location.href = "dashboard.html";
    } catch(e){
        // Als login faalt → registratie
        try {
            await createUserWithEmailAndPassword(auth, username+"@homecrew.local", password);
            localStorage.setItem("homecrewUser", username);
            window.location.href = "dashboard.html";
        } catch(err){
            console.error(err);
            errorEl.textContent = "Kan niet registreren: " + err.message;
        }
    }
});
</script>
</body>
</html>

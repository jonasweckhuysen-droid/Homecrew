<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Homecrew - Taken</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/Homecrew/style.css">
</head>
<body>

<div class="topbar">
  <button class="back-btn" onclick="window.location.href='/Homecrew/dashboard.html'">üè† Home</button>
</div>

<div class="login-box">
    <h1 id="welcome"></h1>

    <h3>Nieuwe taak</h3>
    <input type="text" id="taskTitle" placeholder="Titel">
    <textarea id="taskDesc" placeholder="Beschrijving"></textarea>
    <button class="add-btn" id="addTaskBtn">Toevoegen</button>

    <h3>Lijst taken</h3>
    <ul id="tasks"></ul>

    <button class="logout-btn" id="logoutBtn">Uitloggen</button>
</div>

<script type="module">
import { logout } from './script.js';

const activeUser = localStorage.getItem("homecrewUser");
if (!activeUser) window.location.href = "/Homecrew/index.html";
document.getElementById("welcome").innerText = "Welkom, " + activeUser + " üëã";

// Kleurmapping per gebruiker
const userColors = {
    Jonas: "#3a6ea5",
    Liese: "#DA4453",
    Loreana: "#fcb69f"
};

// -------------------- Taken functies --------------------
function loadTasks() {
    const tasks = JSON.parse(localStorage.getItem("tasks_all")) || [];
    const ul = document.getElementById("tasks");
    ul.innerHTML = "";

    tasks.forEach((task, index) => {
        const li = document.createElement("li");
        const color = userColors[task.user] || "#999";

        li.innerHTML = `
            <span class="user-dot" style="background:${color}"></span>
            <strong>${task.title}</strong>
            <p>${task.desc}</p>
            <small>${task.user}</small>
            <button class="delete-btn">‚ùå</button>
        `;
        li.querySelector(".delete-btn").addEventListener("click", () => removeTask(index));
        ul.appendChild(li);
    });
}

function addTask() {
    const title = document.getElementById("taskTitle").value.trim();
    const desc = document.getElementById("taskDesc").value.trim();
    if (!title) return alert("Vul een titel in");

    const tasks = JSON.parse(localStorage.getItem("tasks_all")) || [];
    tasks.push({ title, desc, user: activeUser });
    localStorage.setItem("tasks_all", JSON.stringify(tasks));

    document.getElementById("taskTitle").value = "";
    document.getElementById("taskDesc").value = "";
    loadTasks();
}

function removeTask(index) {
    const tasks = JSON.parse(localStorage.getItem("tasks_all")) || [];
    tasks.splice(index, 1);
    localStorage.setItem("tasks_all", JSON.stringify(tasks));
    loadTasks();
}

// -------------------- Event listeners --------------------
document.getElementById("addTaskBtn").addEventListener("click", addTask);
document.getElementById("logoutBtn").addEventListener("click", logout);

// Taken laden bij openen
loadTasks();
</script>

<style>
.user-dot {
    display:inline-block;
    width:12px;
    height:12px;
    border-radius:50%;
    margin-right:8px;
    vertical-align:middle;
}
.delete-btn {
    float:right;
    background:#DA4453;
    color:white;
    border:none;
    border-radius:8px;
    padding:3px 7px;
    cursor:pointer;
}
</style>

</body>
</html>

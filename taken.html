<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Homecrew â€” Taken (live)</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="/Homecrew/style.css">

<!-- Font Awesome JS-kit -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<style>
/* PAGINA SPECIFIEK */
.app-body {
  padding:10px;
  font-family: Arial, sans-serif;
  background:#f2f4f7;
}

.login-box {
  max-width:820px;
  margin:20px auto;
}

.card {
  background:white;
  padding:15px;
  border-radius:16px;
  margin-bottom:14px;
}

.event-list {
  padding:0;
  margin:0;
}

.event-item {
  list-style:none;
  padding:12px;
  margin-bottom:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-left:6px solid #3498db;
  background:#fbfbfb;
  border-radius:6px;
}

.delete-btn {
  cursor:pointer;
}

input, textarea {
  width:100%;
  padding:8px;
  margin:6px 0;
  box-sizing:border-box;
  border-radius:6px;
  border:1px solid #ddd;
}

.main-btn {
  padding:10px;
  border:none;
  border-radius:8px;
  background:#3498db;
  color:white;
  cursor:pointer;
  font-weight:bold;
}

.main-btn:hover {
  opacity:0.9;
}

.home-btn {
  padding:8px 12px;
  border:none;
  border-radius:10px;
  background:white;
  color:black;
  font-weight:bold;
  cursor:pointer;
}

.topbar {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px;
  background:linear-gradient(135deg,#667eea,#764ba2);
  color:white;
  margin-bottom:20px;
}
</style>
</head>
<body class="app-body">

<!-- âœ… HEADER -->
<header class="topbar">
  <button class="home-btn" onclick="window.location.href='/Homecrew/dashboard.html'">
    <i class="fa-solid fa-home"></i>
  </button>

  <h2>âœ… Taken</h2>

  <button class="home-btn" onclick="logout()">
    <i class="fa-solid fa-right-from-bracket"></i>
  </button>
</header>

<div class="login-box">
  <h1 id="welcome">Welkom</h1>

  <div class="card">
    <h3>Nieuwe taak toevoegen</h3>
    <input id="taskTitle" type="text" placeholder="Titel" />
    <textarea id="taskDesc" placeholder="Beschrijving (optioneel)"></textarea>
    <div style="display:flex; gap:10px;">
      <button id="addTaskBtn" class="main-btn" style="flex:1">Toevoegen</button>
      <button id="refreshBtn" class="main-btn" style="flex:0 0 130px; background:#607d8b">
        Vernieuw
      </button>
    </div>
  </div>

  <div class="card">
    <h3>Alle taken (live)</h3>
    <ul id="tasksList" class="event-list"></ul>
  </div>
</div>

<script type="module">
// ================= FIREBASE =================
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc,
  onSnapshot,
  query,
  orderBy,
  serverTimestamp,
  deleteDoc,
  doc
} from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCwlr069pxNXEEhIEGNug5Ly_kKSuvxSzs",
  authDomain: "homecrew-d8e21.firebaseapp.com",
  projectId: "homecrew-d8e21",
  storageBucket: "homecrew-d8e21.firebasestorage.app",
  messagingSenderId: "47664248188",
  appId: "1:47664248188:web:0994c6b2ba07f6fee060f9",
  measurementId: "G-5R58JL5D5K"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ================= GEBRUIKER =================
const activeUser =
  localStorage.getItem("homecrewUser") ||
  sessionStorage.getItem("homecrewUser");

if (!activeUser) {
  window.location.href = "/Homecrew/index.html";
}

document.getElementById("welcome").innerText =
  "Welkom, " + activeUser + " ðŸ‘‹";

window.logout = function () {
  localStorage.removeItem("homecrewUser");
  sessionStorage.removeItem("homecrewUser");
  window.location.href = "/Homecrew/index.html";
};

// ================= HULPFUNCTIES =================
function getUserColor(name) {
  const n = (name || "").toLowerCase();
  if (n === "jonas") return "#3498db";
  if (n === "liese") return "#e74c3c";
  if (n === "loreana") return "#ff69b4";
  return "#666";
}

// ================= DOM REFS =================
const tasksListEl = document.getElementById("tasksList");
const addBtn = document.getElementById("addTaskBtn");
const refreshBtn = document.getElementById("refreshBtn");
const titleInput = document.getElementById("taskTitle");
const descInput = document.getElementById("taskDesc");

// ================= ADD TASK =================
async function addTask() {
  const title = titleInput.value.trim();
  const desc = descInput.value.trim();

  if (!title) { alert("Vul een titel in voor de taak"); return; }

  try {
    await addDoc(collection(db, "tasks"), {
      title,
      desc,
      user: activeUser,
      createdAt: serverTimestamp()
    });
    titleInput.value = "";
    descInput.value = "";
  } catch (err) {
    console.error("Fout bij toevoegen taak:", err);
    alert("Kon taak niet toevoegen.");
  }
}

// ================= DELETE TASK =================
async function deleteTask(docId) {
  if (!confirm("Verwijder deze taak?")) return;
  try { await deleteDoc(doc(db, "tasks", docId)); } 
  catch (err) { console.error(err); alert("Kon taak niet verwijderen."); }
}

// ================= LISTENER =================
function startTasksListener() {
  const q = query(collection(db, "tasks"), orderBy("createdAt", "asc"));

  return onSnapshot(q, (snapshot) => {
    tasksListEl.innerHTML = "";

    snapshot.forEach((docSnap) => {
      const data = docSnap.data();
      const id = docSnap.id;

      const li = document.createElement("li");
      li.className = "event-item";

      const left = document.createElement("div");
      left.style.flex = "1";

      const titleEl = document.createElement("strong");
      titleEl.textContent = data.title || "(geen titel)";
      titleEl.style.display = "block";
      titleEl.style.fontSize = "16px";
      titleEl.style.marginBottom = "6px";

      const descEl = document.createElement("div");
      descEl.textContent = data.desc || "";
      descEl.style.fontSize = "14px";
      descEl.style.opacity = "0.9";

      const metaEl = document.createElement("div");
      metaEl.style.marginTop = "6px";
      metaEl.style.fontSize = "12px";
      metaEl.innerHTML = `ðŸ‘¤ <span style="color:${getUserColor(data.user)}; font-weight:600">${data.user||"?"}</span> â€¢ ${data.createdAt?.toDate ? new Date(data.createdAt.toDate()).toLocaleString("nl-BE") : ""}`;

      left.appendChild(titleEl);
      left.appendChild(descEl);
      left.appendChild(metaEl);

      const right = document.createElement("div");
      right.style.marginLeft = "12px";
      right.style.display = "flex";
      right.style.alignItems = "center";

      const delBtn = document.createElement("button");
      delBtn.className = "delete-btn";
      delBtn.style.background = "#DA4453";
      delBtn.style.color = "white";
      delBtn.style.border = "none";
      delBtn.style.borderRadius = "8px";
      delBtn.style.padding = "6px 10px";
      delBtn.style.cursor = "pointer";
      delBtn.textContent = "âŒ";
      delBtn.onclick = () => deleteTask(id);

      right.appendChild(delBtn);
      li.appendChild(left);
      li.appendChild(right);

      tasksListEl.appendChild(li);
    });

    if (!tasksListEl.hasChildNodes()) {
      const empty = document.createElement("div");
      empty.style.padding = "14px";
      empty.style.opacity = "0.9";
      empty.textContent = "Nog geen taken â€” voeg er een toe!";
      tasksListEl.appendChild(empty);
    }
  }, (err) => console.error("Listener error:", err));
}

// ================= EVENTS =================
addBtn.addEventListener("click", addTask);
refreshBtn.addEventListener("click", () => { if (unsubscribe) unsubscribe(); unsubscribe = startTasksListener(); });

// ================= START =================
let unsubscribe = startTasksListener();

</script>
</body>
</html>

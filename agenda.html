<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Homecrew ‚Äì Agenda</title>

<link rel="stylesheet" href="style.css">

<!-- Font Awesome voor icoontjes -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
/* Enige styles die hier nog mogen staan: PAGINA SPECIFIEK */
/* Alles van de header + knoppen zit nu in style.css */

.app-body { 
  padding:10px; 
  font-family: Arial, sans-serif;
  background:#f2f4f7;
}

.list-box{
  display:none;
  margin-top:10px;
}
.list-box.show{
  display:block;
}

.input-group{
  display:flex;
  gap:10px;
  margin-bottom:10px;
}
.input-group input{
  flex:1;
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
}

ul{
  list-style:none;
  padding:0;
}

.event-item { 
  list-style:none; 
  padding:10px; 
  margin-bottom:8px; 
  border-left:6px solid #3498db; 
  background:#fbfbfb; 
  border-radius:6px; 
}

.google-event { 
  border-left-color:#222; 
}

.event-meta { 
  font-size:0.85em; 
  color:#666; 
  margin-top:4px; 
}

.event-user { 
  font-weight:600; 
  margin-top:6px; 
}

input, textarea { 
  width:100%; 
  padding:8px; 
  margin:6px 0; 
  box-sizing:border-box; 
  border-radius:6px; 
  border:1px solid #ddd; 
}

.nav-btn { 
  padding:8px 12px; 
  border-radius:8px; 
  background:#3a6ea5; 
  color:white; 
  border:none; 
  cursor:pointer; 
}
</style>
</head>

<body class="app-body">

<!-- ‚úÖ STANDAARD HEADER (nu volledig uit style.css) -->
<header class="topbar">
  <button onclick="window.location.href='dashboard.html'" class="home-btn">
    <i class="fas fa-home"></i>
  </button>

  <h2>üìÖ Homecrew Agenda</h2>

  <button onclick="logout()" class="home-btn">
    <i class="fas fa-sign-out-alt"></i>
  </button>
</header>

<main class="content">
  <h3 id="welcomeUser"></h3>

  <div class="card">
    <h4>Nieuwe afspraak toevoegen</h4>
    <input type="text" id="eventTitle" placeholder="Titel">
    <input type="datetime-local" id="eventDate">
    <textarea id="eventDescription" placeholder="Beschrijving (optioneel)"></textarea>
    <button class="nav-btn" onclick="addLocalEvent()">Toevoegen</button>
  </div>

  <div class="card">
    <h4>üìå Afspraak overzicht</h4>
    <ul id="eventList" class="event-list"></ul>
    <p id="agenda-error" style="color:red; display:none; margin-top:10px;"></p>
    <p id="no-events" style="display:none; color:#666; margin-top:10px;">Geen afspraken gevonden.</p>
  </div>
</main>

<script>
/* ===== CONFIG ===== */

const LOCAL_EVENTS_KEY = "homecrewLocalEvents";

// üëâ JOUW GOOGLE API KEY
const GOOGLE_API_KEY = "4a993261a71ece889094805bab5b864a";

// ‚úÖ JOUW CALENDAR ID
const CALENDAR_ID = "b3756ae16d0f11ea12a33407c6077e5925740ab0ce0d19514aa77a7fc6a6e0c0@group.calendar.google.com";

const MAX_GOOGLE_EVENTS = 50;

/* ===== HELPERS ===== */

function escapeHtml(str){
  if (!str) return "";
  return String(str)
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;")
    .replace(/"/g,"&quot;")
    .replace(/'/g,"&#39;");
}

function getUserColor(u){
  if (!u) return "#999";
  const s = u.toLowerCase();
  if (s === "jonas") return "#3498db";
  if (s === "liese") return "#e74c3c";
  if (s === "loreana") return "#ff69b4";
  return "#777";
}

/* ===== USER ===== */

const user = localStorage.getItem("homecrewUser") || sessionStorage.getItem("homecrewUser");

if (!user) {
  window.location.href = "index.html";
}

document.getElementById("welcomeUser").innerText = "Welkom, " + user + " üëã";

function logout(){
  localStorage.clear();
  sessionStorage.clear();
  window.location.href = "index.html";
}

/* ===== LOKALE EVENTS ===== */

function addLocalEvent(){
  const title = document.getElementById("eventTitle").value.trim();
  const date = document.getElementById("eventDate").value;
  const desc = document.getElementById("eventDescription").value.trim();

  if (!title || !date) {
    alert("Titel en datum zijn verplicht");
    return;
  }

  const events = JSON.parse(localStorage.getItem(LOCAL_EVENTS_KEY) || "[]");

  events.push({
    user,
    title,
    date,
    description: desc
  });

  localStorage.setItem(LOCAL_EVENTS_KEY, JSON.stringify(events));

  document.getElementById("eventTitle").value = "";
  document.getElementById("eventDate").value = "";
  document.getElementById("eventDescription").value = "";

  loadEvents();
}

/* ===== GOOGLE EVENTS ===== */

async function fetchGoogleEvents(){

  const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(CALENDAR_ID)}/events` +
    `?key=${GOOGLE_API_KEY}` +
    `&maxResults=${MAX_GOOGLE_EVENTS}` +
    `&orderBy=startTime` +
    `&singleEvents=true` +
    `&timeMin=${new Date().toISOString()}`;

  try {
    const res = await fetch(url);

    if (!res.ok) {
      const text = await res.text();
      throw new Error(text);
    }

    const data = await res.json();

    return (data.items || []).map(ev => ({
      title: ev.summary || "Geen titel",
      start: ev.start.dateTime ? new Date(ev.start.dateTime) : new Date(ev.start.date),
      end: ev.end.dateTime ? new Date(ev.end.dateTime) : new Date(ev.end.date),
      location: ev.location || ""
    }));

  } catch(error){
    console.error("Google error:", error);
    const err = document.getElementById("agenda-error");
    err.style.display = "block";
    err.innerText = "Google Agenda fout: " + error.message;
    return [];
  }
}

/* ===== WEERGAVE ===== */

async function loadEvents(){

  const list = document.getElementById("eventList");
  const noEventsMsg = document.getElementById("no-events");
  const err = document.getElementById("agenda-error");

  list.innerHTML = "";
  noEventsMsg.style.display = "none";
  err.style.display = "none";

  let hasEvents = false;

  // Lokale events
  const localEvents = JSON.parse(localStorage.getItem(LOCAL_EVENTS_KEY) || "[]");

  localEvents.sort((a,b)=> new Date(a.date) - new Date(b.date));

  localEvents.forEach(ev => {
    hasEvents = true;
    const li = document.createElement("li");
    li.className = "event-item";
    li.style.borderLeft = "6px solid " + getUserColor(ev.user);

    li.innerHTML = `
      <strong>${escapeHtml(ev.title)}</strong>
      <div class="event-meta">${new Date(ev.date).toLocaleString("nl-BE")}</div>
      <div class="event-user" style="color:${getUserColor(ev.user)}">üë§ ${escapeHtml(ev.user)}</div>
      ${ev.description ? `<div>${escapeHtml(ev.description)}</div>` : ""}
    `;

    list.appendChild(li);
  });

  // Google events
  const googleEvents = await fetchGoogleEvents();

  googleEvents.sort((a,b)=>a.start - b.start);

  googleEvents.forEach(ev =>{
    hasEvents = true;

    const li = document.createElement("li");
    li.className = "event-item google-event";

    li.innerHTML = `
      <strong>${escapeHtml(ev.title)}</strong>
      <div class="event-meta">${ev.start.toLocaleString("nl-BE")}</div>
      <div style="color:black;">üìÖ Google Agenda</div>
      ${ev.location ? `<div>üìç ${escapeHtml(ev.location)}</div>` : ""}
    `;

    list.appendChild(li);
  });

  if (!hasEvents){
    noEventsMsg.style.display = "block";
  }
}

/* ===== AUTO ===== */

document.addEventListener("DOMContentLoaded", loadEvents);
setInterval(loadEvents, 5 * 60 * 1000);
</script>

</body>
</html>

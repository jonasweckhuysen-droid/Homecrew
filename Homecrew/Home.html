import React, { useState, useEffect } from 'react';
import { base44 } from '@/api/base44Client';
import { useQuery } from '@tanstack/react-query';
import { Link } from 'react-router-dom';
import { createPageUrl } from '@/utils';
import { format } from 'date-fns';
import { nl } from 'date-fns/locale';

export default function Home() {
  const [user, setUser] = useState(null);
  const [weather, setWeather] = useState(null);
  const today = format(new Date(), 'yyyy-MM-dd');

  // âœ… AUTH CHECK
  useEffect(() => {
    const storedUser =
      localStorage.getItem("homecrewUser") ||
      sessionStorage.getItem("homecrewUser");

    if (!storedUser) {
      window.location.href = "/index.html";
      return;
    }

    // Zet lokale gebruiker
    setUser({ full_name: storedUser });

    // Haal base44 user (optioneel)
    base44.auth.me().then(setUser).catch(() => {});

    // Weer info
    base44.integrations.Core.InvokeLLM({
      prompt: "What is the current weather in Belgium? Very short Dutch summary.",
      add_context_from_internet: true
    }).then(setWeather).catch(() => {});

  }, []);

  const getGreeting = () => {
    const h = new Date().getHours();
    if (h < 12) return "Goedemorgen";
    if (h < 18) return "Goedemiddag";
    return "Goedenavond";
  };

  if (!user) return null;

  return (
    <div className="max-w-6xl mx-auto p-6">

      <h1 className="text-2xl font-bold">
        {getGreeting()}, {user.full_name} ğŸ‘‹
      </h1>

      {weather && (
        <p className="text-gray-600 mt-2">
          Weer vandaag: {weather}
        </p>
      )}

      <div className="mt-6 grid grid-cols-2 gap-4">
        <Link to={createPageUrl('Calendar')} className="card">ğŸ“… Agenda</Link>
        <Link to={createPageUrl('Messages')} className="card">ğŸ’¬ Berichten</Link>
        <Link to={createPageUrl('Shopping')} className="card">ğŸ›’ Boodschappen</Link>
        <Link to={createPageUrl('TodoLists')} className="card">âœ… Taken</Link>
      </div>

      <button
        className="mt-8 text-red-500"
        onClick={() => {
          localStorage.removeItem("homecrewUser");
          sessionStorage.removeItem("homecrewUser");
          window.location.href = "/index.html";
        }}
      >
        Uitloggen
      </button>

    </div>
  );
}

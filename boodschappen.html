<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Homecrew - Boodschappen</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="style.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCwlr069pxNXEEhIEGNug5Ly_kKSuvxSzs",
  authDomain: "homecrew-d8e21.firebaseapp.com",
  databaseURL: "https://homecrew-d8e21-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "homecrew-d8e21",
  storageBucket: "homecrew-d8e21.firebasestorage.app",
  messagingSenderId: "47664248188",
  appId: "1:47664248188:web:0994c6b2ba07f6fee060f9"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* USER CHECK */
const user = localStorage.getItem("homecrewUser") || sessionStorage.getItem("homecrewUser");
if(!user) window.location.href = "index.html";

document.addEventListener("DOMContentLoaded", ()=>{
    document.getElementById("welcomeUser").innerText = "Welkom, " + user + " ðŸ‘‹";
})

/* LIVE LOAD */
function liveLoad(place){
    const listRef = ref(db, "boodschappen/" + place);

    onValue(listRef, (snapshot)=>{
        const ul = document.getElementById(place + "List");
        ul.innerHTML = "";

        if(snapshot.exists()){
            const data = snapshot.val();

            Object.keys(data).forEach(key=>{
                const li = document.createElement("li");

                const text = document.createElement("span");
                text.textContent = data[key].item;

                const del = document.createElement("button");
                del.innerHTML = `<i class="fas fa-trash"></i>`;
                del.style.width = "40px";
                del.style.background = "#e74c3c";
                del.onclick = ()=> removeItem(place,key);

                li.appendChild(text);
                li.appendChild(del);
                ul.appendChild(li);
            });
        }
    })
}

/* -------- ADD -------- */
window.addItem = function(place){
    const input = document.getElementById(place + "Input");
    const value = input.value.trim();
    if(!value) return;

    const listRef = ref(db, "boodschappen/" + place);
    push(listRef, {
        item: value,
        user: user,
        time: Date.now()
    });

    input.value = "";
}

/* -------- REMOVE -------- */
function removeItem(place,key){
    const itemRef = ref(db, "boodschappen/" + place + "/" + key);
    remove(itemRef);
}

/* -------- LOGOUT -------- */
window.logout = function(){
  localStorage.clear();
  sessionStorage.clear();
  window.location.href = "index.html";
}

/* -------- START -------- */
liveLoad("vingardium");
liveLoad("drijvelden");

</script>
</head>

<body class="app-body">

<header class="topbar">
  <button onclick="window.location.href='dashboard.html'" class="home-btn">
    <i class="fas fa-home"></i>
  </button>

  <h2>ðŸ›’ Boodschappen</h2>

  <button onclick="logout()" class="home-btn">
    <i class="fas fa-sign-out-alt"></i>
  </button>
</header>

<main class="content">

<h3 id="welcomeUser"></h3>

<div class="card">

<div class="dashboard-buttons">
  <div id="vingardiumBtn" class="dash-btn" onclick="document.getElementById('vingardium-box').classList.toggle('show')">
    <i class="fas fa-seedling"></i> Vingardium <i class="fas fa-chevron-down"></i>
  </div>

  <div id="drijveldenBtn" class="dash-btn" onclick="document.getElementById('drijvelden-box').classList.toggle('show')">
    <i class="fas fa-tractor"></i> Drijvelden <i class="fas fa-chevron-down"></i>
  </div>
</div>

<div class="list-box show" id="vingardium-box">
  <div class="input-group">
    <input type="text" id="vingardiumInput" placeholder="Nieuw item...">
    <button onclick="addItem('vingardium')"><i class="fas fa-plus"></i></button>
  </div>
  <ul id="vingardiumList"></ul>
</div>

<div class="list-box show" id="drijvelden-box">
  <div class="input-group">
    <input type="text" id="drijveldenInput" placeholder="Nieuw item...">
    <button onclick="addItem('drijvelden')"><i class="fas fa-plus"></i></button>
  </div>
  <ul id="drijveldenList"></ul>
</div>

</div>
</main>
</body>
</html>

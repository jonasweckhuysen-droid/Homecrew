
<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Homecrew - Boodschappen</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f3f6f9;
    -webkit-user-select: none;
    user-select: none;
}

.app-body { padding: 12px; }

.topbar {
    background: #2c3e50;
    color: white;
    padding: 14px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.home-btn {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
}

.card { display: flex; flex-direction: column; gap: 26px; }

.dashboard-buttons {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.dash-btn {
    padding: 14px;
    border-radius: 12px;
    color: white;
    font-weight: bold;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
}

.vingardium-btn { background: linear-gradient(135deg,#27ae60,#1e8449); }
.drijvelden-btn { background: linear-gradient(135deg,#f39c12,#d35400); }

.list-box {
    display: none;
    background: white;
    padding: 14px;
    border-radius: 16px;
}

.list-box.show { display: block; }

.vingardium-box { border-left: 8px solid #27ae60; background: #ecfdf5; }
.drijvelden-box { border-left: 8px solid #f39c12; background: #fff5e6; }

.house-title {
    padding: 10px;
    margin-bottom: 12px;
    border-radius: 10px;
    font-weight: bold;
    color: white;
    display: flex;
    gap: 8px;
}

.vingardium-title { background:#27ae60; }
.drijvelden-title { background:#f39c12; }

.input-group { display:flex; margin-bottom:10px; }

.input-group input {
    flex:1;
    padding:10px;
    border-radius:10px 0 0 10px;
    border:none;
}

.input-group button {
    width:55px;
    border:none;
    border-radius:0 10px 10px 0;
    background:linear-gradient(135deg,#2980b9,#3498db);
    color:white;
}

ul { list-style:none; padding:0; margin:0; }

li {
    padding: 10px 12px;
    margin-bottom: 8px;
    background: white;
    border-radius: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: grab;
}

li.dragging {
    opacity: 0.4;
}

li span { flex:1; }

li button {
    background:#e74c3c;
    border:none;
    color:white;
    width:38px;
    height:38px;
    border-radius:50%;
}
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCwlr069pxNXEEhIEGNug5Ly_kKSuvxSzs",
  authDomain: "homecrew-d8e21.firebaseapp.com",
  databaseURL: "https://homecrew-d8e21-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "homecrew-d8e21",
  storageBucket: "homecrew-d8e21.firebasestorage.app",
  messagingSenderId: "47664248188",
  appId: "1:47664248188:web:0994c6b2ba07f6fee060f9"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const user = localStorage.getItem("homecrewUser") || sessionStorage.getItem("homecrewUser");
if(!user) location.href="index.html";

document.addEventListener("DOMContentLoaded",()=>{
  document.getElementById("welcomeUser").innerText = "Welkom, " + user + " ðŸ‘‹";
});

function enableDragSort(ul, place){
  let dragged;

  ul.querySelectorAll("li").forEach(li=>{
    li.draggable = true;

    li.addEventListener("dragstart", ()=>{
      dragged = li;
      li.classList.add("dragging");
    });

    li.addEventListener("dragend", ()=>{
      li.classList.remove("dragging");
      saveOrder(ul, place);
    });

    li.addEventListener("dragover", e=>{
      e.preventDefault();
      const after = [...ul.children].find(c =>
        e.clientY <= c.offsetTop + c.offsetHeight / 2
      );
      if(after && after !== dragged) ul.insertBefore(dragged, after);
      else ul.appendChild(dragged);
    });
  });
}

function saveOrder(ul, place){
  [...ul.children].forEach((li, index)=>{
    update(ref(db,`boodschappen/${place}/${li.dataset.key}`),{
      order:index
    });
  });
}

function liveLoad(place){
  const listRef = ref(db,"boodschappen/"+place);
  onValue(listRef,snap=>{
    const ul = document.getElementById(place+"List");
    const count = document.getElementById(place+"Count");
    ul.innerHTML="";
    let items=[];

    if(snap.exists()){
      Object.entries(snap.val()).forEach(([key,val])=>{
        items.push({key,...val});
      });
    }

    items.sort((a,b)=>(a.order??0)-(b.order??0));
    count.textContent=`(${items.length})`;

    items.forEach(i=>{
      const li=document.createElement("li");
      li.dataset.key=i.key;
      li.innerHTML=`<span>${i.item}</span>
        <button onclick="removeItem('${place}','${i.key}')">
          <i class="fas fa-trash"></i>
        </button>`;
      ul.appendChild(li);
    });

    enableDragSort(ul, place);
  });
}

window.addItem=function(place){
  const input=document.getElementById(place+"Input");
  if(!input.value.trim())return;
  push(ref(db,"boodschappen/"+place),{
    item:input.value,
    user,
    order:Date.now()
  });
  input.value="";
}

window.removeItem=function(place,key){
  remove(ref(db,"boodschappen/"+place+"/"+key));
}

window.logout=function(){
  localStorage.clear();
  sessionStorage.clear();
  location.href="index.html";
}

liveLoad("vingardium");
liveLoad("drijvelden");
</script>
</head>

<body class="app-body">

<header class="topbar">
  <button onclick="location.href='dashboard.html'" class="home-btn"><i class="fas fa-home"></i></button>
  <h2>ðŸ›’ Boodschappen</h2>
  <button onclick="logout()" class="home-btn"><i class="fas fa-sign-out-alt"></i></button>
</header>

<h3 id="welcomeUser"></h3>

<div class="dashboard-buttons">
  <div class="dash-btn vingardium-btn" onclick="vingardiumBox.classList.toggle('show')">
    <div>ðŸŒ± VINGARDIUM <span id="vingardiumCount">(0)</span></div><i class="fas fa-chevron-down"></i>
  </div>
  <div class="dash-btn drijvelden-btn" onclick="drijveldenBox.classList.toggle('show')">
    <div>ðŸšœ DRIJVELDEN <span id="drijveldenCount">(0)</span></div><i class="fas fa-chevron-down"></i>
  </div>
</div>

<div class="list-box vingardium-box" id="vingardiumBox">
  <div class="house-title vingardium-title">ðŸŒ± Vingardium</div>
  <div class="input-group">
    <input id="vingardiumInput"><button onclick="addItem('vingardium')">+</button>
  </div>
  <ul id="vingardiumList"></ul>
</div>

<div class="list-box drijvelden-box" id="drijveldenBox">
  <div class="house-title drijvelden-title">ðŸšœ Drijvelden</div>
  <div class="input-group">
    <input id="drijveldenInput"><button onclick="addItem('drijvelden')">+</button>
  </div>
  <ul id="drijveldenList"></ul>
</div>

</body>
</html>
